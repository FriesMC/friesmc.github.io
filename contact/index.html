<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã */
        .form-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .required:after {
            content: " *";
            color: red;
        }
        
        /* –°—Ç–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 300px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background-color: #fff;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;
            opacity: 0;
        }
        .notification-show {
            transform: translateX(0) !important;
            opacity: 1 !important;
        }
        .notification-success {
            border-left: 4px solid #28a745;
        }
        .notification-error {
            border-left: 4px solid #dc3545;
        }
        
        /* –°—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–æ–≤ */
        .logs-page {
            display: none;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
    <div class="container" id="mainForm">
        <div class="form-container">
            <h2 class="text-center mb-4">–§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏</h2>
            
            <form id="feedbackForm">
                <div class="mb-3">
                    <label for="name" class="form-label required">–ò–º—è</label>
                    <input type="text" class="form-control" id="name" required>
                </div>
                
                <div class="mb-3">
                    <label for="telegram" class="form-label required">–¢–µ–ª–µ–≥—Ä–∞–º –¥–ª—è —Å–≤—è–∑–∏</label>
                    <input type="text" class="form-control" id="telegram" placeholder="@username –∏–ª–∏ +79991234567" required>
                </div>
                
                <div class="mb-3">
                    <label for="problem" class="form-label required">–ü—Ä–æ–±–ª–µ–º–∞</label>
                    <select class="form-select" id="problem" required>
                        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                        <option value="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞</option>
                        <option value="–í–æ–ø—Ä–æ—Å –ø–æ —É—Å–ª—É–≥–∞–º">–í–æ–ø—Ä–æ—Å –ø–æ —É—Å–ª—É–≥–∞–º</option>
                        <option value="–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ">–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ</option>
                        <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="comment" class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea class="form-control" id="comment" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
            
            <div class="text-center mt-3">
                <a href="#" id="viewLogsLink" class="text-secondary">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–ª–æ–≥–∏ –æ—à–∏–±–æ–∫)</a>
            </div>
        </div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–æ–≤ -->
    <div class="container" id="logsPage">
        <div class="form-container">
            <h2 class="text-center mb-4">–õ–æ–≥–∏ –æ—à–∏–±–æ–∫</h2>
            
            <div class="mb-3">
                <input type="password" id="adminPassword" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            </div>
            
            <button id="showLogsBtn" class="btn btn-primary w-100 mb-3">–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏</button>
            <button id="backToFormBtn" class="btn btn-secondary w-100">–ù–∞–∑–∞–¥ –∫ —Ñ–æ—Ä–º–µ</button>
            
            <div id="logsContainer" class="mt-4" style="display: none;">
                <h4 class="mb-3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏:</h4>
                <div id="logsList"></div>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification">
        <div id="notification-message"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const ADMIN_PASSWORD = "superadmin123"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å!
        const LOGS_STORAGE_KEY = "feedback_form_error_logs";
        const TELEGRAM_BOT_TOKEN = "7461042577:AAE40_KkgdkfAXsq1E3SFi2_6TeIZ5p_SxU";
        const TELEGRAM_CHAT_ID = "-4636420852";

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const mainForm = document.getElementById('mainForm');
        const logsPage = document.getElementById('logsPage');
        const viewLogsLink = document.getElementById('viewLogsLink');
        const backToFormBtn = document.getElementById('backToFormBtn');
        const showLogsBtn = document.getElementById('showLogsBtn');
        const adminPassword = document.getElementById('adminPassword');
        const logsContainer = document.getElementById('logsContainer');
        const logsList = document.getElementById('logsList');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
            document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('name').value.trim(),
                    telegram: document.getElementById('telegram').value.trim(),
                    problem: document.getElementById('problem').value,
                    comment: document.getElementById('comment').value.trim()
                };
                
                if (!formData.name || !formData.telegram || !formData.problem) {
                    showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                try {
                    await sendToTelegram(formData);
                    showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ Telegram.', 'success');
                    this.reset();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    logError(error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
                }
            });

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            viewLogsLink.addEventListener('click', function(e) {
                e.preventDefault();
                mainForm.style.display = 'none';
                logsPage.style.display = 'block';
            });

            backToFormBtn.addEventListener('click', function() {
                mainForm.style.display = 'block';
                logsPage.style.display = 'none';
                logsContainer.style.display = 'none';
            });

            showLogsBtn.addEventListener('click', function() {
                if (adminPassword.value === ADMIN_PASSWORD) {
                    loadLogs();
                    logsContainer.style.display = 'block';
                } else {
                    showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏–∏
        async function sendToTelegram(data) {
            const text = `üì¢ <b>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</b>\n\n` +
                        `üë§ <b>–ò–º—è:</b> ${data.name}\n` +
                        `üì± <b>Telegram:</b> ${data.telegram}\n` +
                        `‚ùó <b>–ü—Ä–æ–±–ª–µ–º–∞:</b> ${data.problem}\n` +
                        `üìù <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b> ${data.comment || '–ù–µ —É–∫–∞–∑–∞–Ω'}`;
            
            const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: text,
                    parse_mode: 'HTML'
                })
            });
            
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ Telegram API');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            notification.className = 'notification-hidden';
            void notification.offsetWidth;
            
            messageElement.textContent = message;
            notification.classList.add(`notification-${type}`, 'notification-show');
            
            setTimeout(() => {
                notification.classList.remove('notification-show');
            }, 5000);
        }

        function logError(error) {
            const logs = JSON.parse(localStorage.getItem(LOGS_STORAGE_KEY)) || [];
            logs.unshift({
                timestamp: new Date().toISOString(),
                message: error.message,
                stack: error.stack || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'
            });
            localStorage.setItem(LOGS_STORAGE_KEY, JSON.stringify(logs));
        }

        function loadLogs() {
            const logs = JSON.parse(localStorage.getItem(LOGS_STORAGE_KEY)) || [];
            logsList.innerHTML = logs.map(log => `
                <div class="log-entry">
                    <strong>${new Date(log.timestamp).toLocaleString()}</strong><br>
                    ${log.message}<br>
                    <small class="text-muted">${log.stack}</small>
                </div>
            `).join('');
        }
    </script>
</body>
</html>